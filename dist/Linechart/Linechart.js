'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_react=require('react'),_react2=_interopRequireDefault(_react),_d=require('d3'),d3=_interopRequireWildcard(_d);Object.defineProperty(exports,'__esModule',{value:!0});require('d3-selection-multi');var _propTypes=require('prop-types'),_propTypes2=_interopRequireDefault(_propTypes);function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _objectWithoutProperties(a,b){var c={};for(var d in a)0<=b.indexOf(d)||Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);return c}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var Linechart=function(a){function b(a){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return _inherits(b,a),_createClass(b,[{key:'componentDidMount',value:function componentDidMount(){var a=this.props,b=a.data,c=_objectWithoutProperties(a,['data']),d=this.refs.el,e=new d3line(d);e.render(b,c)}},{key:'render',value:function render(){return _react2.default.createElement('svg',{ref:'el'})}}]),b}(_react.Component);Linechart.propTypes={data:_propTypes2.default.array.isRequired,width:_propTypes2.default.number,height:_propTypes2.default.number,margintop:_propTypes2.default.number,marginbottom:_propTypes2.default.number,marginright:_propTypes2.default.number,marginleft:_propTypes2.default.number,getX:_propTypes2.default.func,getY:_propTypes2.default.func,tiptext:_propTypes2.default.func,lineattrs:_propTypes2.default.object,linestyles:_propTypes2.default.object,plotattrs:_propTypes2.default.object,plotstyles:_propTypes2.default.object,plotattrs_hover:_propTypes2.default.object,plotstyles_hover:_propTypes2.default.object,timeParse:_propTypes2.default.string,timeformat:_propTypes2.default.string,showgrid:_propTypes2.default.bool,showgridtip:_propTypes2.default.bool,showplottip:_propTypes2.default.bool,plotclick:_propTypes2.default.func,lineAnimateTime:_propTypes2.default.number},Linechart.defaultProps={width:800,height:300,margintop:50,marginbottom:30,marginright:50,marginleft:40,getX:function getX(a){return a.date},getY:function getY(a){return a.count},tiptext:function tiptext(a){return a.count},lineattrs:{},linestyles:{},plotattrs:{},plotstyles:{},plotattrs_hover:{},plotstyles_hover:{},timeParse:'%Y-%m-%d',timeformat:'%m-%d',showgrid:!0,showgridtip:!0,showplottip:!0,plotclick:function plotclick(){},lineAnimateTime:1e3};var d3line=function(){function a(b){_classCallCheck(this,a),this.svg=d3.select(b)}return _createClass(a,[{key:'render',value:function render(a,b){var c=b.width,d=b.height,e=b.margintop,f=b.marginbottom,h=b.marginright,i=b.marginleft,j=b.lineattr,k=b.linestyles,l=b.plotattrs,m=b.plotstyles,n=b.plotattrs_hover,o=b.plotstyles_hover,p=b.getX,q=b.getY,r=b.tiptext,s=b.showgridtip,t=b.showplottip,u=b.showgrid,v=b.timeParse,w=b.timeformat,z=b.lineAnimateTime,A=b.plotclick,B=d3.timeParse(v);a.map(function(a){a.X=B(p(a)),a.Y=q(a)});var C=d3.scaleTime().range([0,c]),x=d3.scaleLinear().rangeRound([d,0]),y=d3.line().x(function(a){return C(a.X)}).y(function(a){return x(a.Y)});C.domain(d3.extent(a,function(a){return a.X})),x.domain([0,d3.max(a,function(a){return 1.05*a.Y})]);var D=this.svg.attr('width',c+i+h).attr('height',d+e+f).append('g').attr('transform','translate( '+i+' , '+e+' )');if(D.append('g').attr('class','axis axis--x').attr('transform','translate(0,'+d+')').call(d3.axisBottom(C).ticks(10).tickFormat(d3.timeFormat(w))),D.append('g').attr('class','axis axis--y').call(d3.axisLeft(x)),u){var G=D.append('g');G.append('g').call(d3.axisBottom(C).tickSize(d).tickFormat('')).attr('stroke-opacity',0.3).attr('stroke-width',1).attr('shape-rendering','crispEdges').select('path').attr('stroke-width',0),G.append('g').call(d3.axisLeft(x).tickSize(-c).tickFormat('')).attr('stroke-opacity',0.3).attr('stroke-width',1).attr('shape-rendering','crispEdges').select('path').attr('stroke-width',0)}var g=D.datum(a).append('path').attrs(_extends({stroke:'#ace',"stroke-linejoin":'round',"stroke-linecap":'round',"stroke-width":1.5},j)).styles(_extends({},k)).attr('fill','none').attr('d',y),E=g.node().getTotalLength();g.attr('stroke-dasharray',E+' '+E).attr('stroke-dashoffset',E).transition().duration(z).ease(d3.easeLinear).attr('stroke-dashoffset',0);var F=D.append('g').selectAll('tip').data(a).enter().append('g');F.on('mouseover',function(){var a=d3.select(this);a.select('line').transition().duration(100).attr('stroke','#888').attr('stroke-width',2),a.select('text').attr('dy','12').transition().duration(800).attr('dy','0').attr('fill','#f00'),a.select('circle').transition().duration(800).attrs(_extends({fill:'#f00'},n)).styles(_extends({},o))}).on('mouseout',function(){var a=d3.select(this);a.select('line').transition().duration(100).attr('stroke','rgba(0,0,0,0)'),a.select('text').transition().duration(500).attr('fill','rgba(0,0,0,0)'),a.select('circle').transition().duration(800).attrs(_extends({r:5,fill:'#ace'},l)).styles(_extends({},m))}),s&&F.append('line').attr('x1',function(a){return C(a.X)}).attr('y1',0).attr('x2',function(a){return C(a.X)}).attr('y2',d).attr('stroke','rgba(0,0,0,0)').attr('stroke-width',1),F.append('rect').attr('x',function(a){return C(a.X)}).attr('y',function(){return 0}).attr('width',1).attr('height',d).attr('fill','rgba(0,0,0,0)'),t&&F.append('circle').attr('cx',function(a){return C(a.X)}).attr('cy',function(a){return x(a.Y)}).attrs(_extends({r:5,fill:'#ace'},l)).styles(_extends({cursor:'pointer'},m)).on('click',A),F.append('text').text(r).attr('text-anchor','start').attr('font-size',14).attr('fill','rgba(0,0,0,0)').attr('font-weight','bold').attr('dy','1em').attr('dx','0.8em').attr('transform',function(a){return'translate('+C(a.X)+','+x(a.Y)+')'})}}]),a}();exports.default=Linechart;