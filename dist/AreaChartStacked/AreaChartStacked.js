"use strict";function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.AreaChartStacked=AreaChartStacked;var _react=_interopRequireDefault(require("react")),d3=_interopRequireWildcard(require("d3")),_propTypes=_interopRequireDefault(require("prop-types")),_excluded=["data"];function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!=key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj["default"]=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(source,excluded){if(null==source)return{};var key,i,target=_objectWithoutPropertiesLoose(source,excluded);if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++)key=sourceSymbolKeys[i],0<=excluded.indexOf(key)||Object.prototype.propertyIsEnumerable.call(source,key)&&(target[key]=source[key])}return target}function _objectWithoutPropertiesLoose(source,excluded){if(null==source)return{};var key,i,target={},sourceKeys=Object.keys(source);for(i=0;i<sourceKeys.length;i++)key=sourceKeys[i],0<=excluded.indexOf(key)||(target[key]=source[key]);return target}function AreaChartStacked(props){var svgRef=_react["default"].useRef(null),handleLoad=function(){var data=props.data,attr=_objectWithoutProperties(props,_excluded);D3AreaChartStacked(svgRef.current,data,attr)};return _react["default"].useEffect(function(){handleLoad()},[]),_react["default"].createElement("svg",{ref:svgRef})}AreaChartStacked.propTypes={data:_propTypes["default"].array.isRequired,getX:_propTypes["default"].func,xKey:_propTypes["default"].string,keysOfGroups:_propTypes["default"].array,width:_propTypes["default"].number,height:_propTypes["default"].number,chartTitleText:_propTypes["default"].string,tooltipTitle:_propTypes["default"].func,xAxisText:_propTypes["default"].string,yAxisText:_propTypes["default"].string,utcParse:_propTypes["default"].string,formatTimeType:_propTypes["default"].func,curveType:_propTypes["default"].func,xType:_propTypes["default"].func,yType:_propTypes["default"].func,marginTop:_propTypes["default"].number,marginRight:_propTypes["default"].number,marginBottom:_propTypes["default"].number,marginLeft:_propTypes["default"].number,xDomain:_propTypes["default"].arrayOf(_propTypes["default"].number),yDomain:_propTypes["default"].arrayOf(_propTypes["default"].number),xRange:_propTypes["default"].arrayOf(_propTypes["default"].number),yRange:_propTypes["default"].arrayOf(_propTypes["default"].number),lineNodeRadius:_propTypes["default"].number,strokeColor:_propTypes["default"].arrayOf(_propTypes["default"].string),areaColor:_propTypes["default"].arrayOf(_propTypes["default"].string),areaOpacity:_propTypes["default"].number,strokeLinecap:_propTypes["default"].string,strokeLinejoin:_propTypes["default"].string,strokeWidth:_propTypes["default"].number,strokeOpacity:_propTypes["default"].number,animationTime:_propTypes["default"].number,enableAnimation:_propTypes["default"].bool,enableLineNode:_propTypes["default"].bool,enableTooltip:_propTypes["default"].bool,enableXAxis:_propTypes["default"].bool,enableYAxis:_propTypes["default"].bool,enableLinePath:_propTypes["default"].bool,enableLegend:_propTypes["default"].bool},AreaChartStacked.defaultProps={getX:void 0,xKey:"date",keysOfGroups:["value"],width:500,height:300,chartTitleText:"",tooltipTitle:void 0,xAxisText:"",yAxisText:"",utcParse:"%Y-%m-%d",formatTimeType:d3.utcParse,curveType:d3.curveLinear,xType:d3.scaleTime,yType:d3.scaleLinear,marginTop:40,marginRight:40,marginBottom:20,marginLeft:60,xDomain:void 0,yDomain:void 0,xRange:void 0,yRange:void 0,lineNodeRadius:5,strokeColor:void 0,areaColor:void 0,areaOpacity:.6,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,strokeOpacity:1,animationTime:1e3,enableAnimation:!0,enableLineNode:!0,enableTooltip:!0,enableXAxis:!0,enableYAxis:!0,enableLinePath:!1,enableLegend:!0};function D3AreaChartStacked(element,data,_ref){function highlight(_,d){"all"===d||selectedOne||(linePath.selectAll(".all").style("opacity",.2),lineNode.selectAll(".all").style("opacity",.2),areaPath.selectAll(".all").style("opacity",.2),linePath.selectAll("._"+d).style("opacity",strokeOpacity),lineNode.selectAll("._"+d).style("opacity",strokeOpacity),areaPath.selectAll("._"+d).style("opacity",areaOpacity))}function noHighlight(){linePath.selectAll(".all").style("opacity",strokeOpacity),lineNode.selectAll(".all").style("opacity",strokeOpacity),areaPath.selectAll(".all").style("opacity",areaOpacity)}function selectOne(_,d){selectedOne=!0,y.map(function(data){data.key===d||"all"===d?data.key===d&&(linePath.select("._"+data.key).transition().attr("d",line(data)).duration(500),lineNode.selectAll("._"+data.key).transition().attr("cy",function(d){return yScale(d[1])}).attr("r",lineNodeRadius).duration(500),areaPath.select("._"+data.key).transition().attr("d",area(data)).duration(500)):(linePath.select("._"+data.key).transition().attr("d",line0(data)).duration(500),lineNode.selectAll("._"+data.key).transition().attr("cy",yScale(0)).attr("r",0).duration(500),areaPath.select("._"+data.key).transition().attr("d",area0(data)).duration(500))}),legend.selectAll(".all").style("opacity",.2),legend.selectAll(".legend_"+d).style("opacity",1)}function selectAll(){selectedOne=!1,linePath.selectAll(".all").data(y).transition().attr("d",function(d){return line(d)}).duration(500),lineNode.selectAll(".all").transition().attr("cy",function(d){return yScale(d[1])}).attr("r",lineNodeRadius).duration(500),areaPath.selectAll(".all").transition().attr("d",function(d){return area(d)}).duration(500),legend.selectAll(".all").style("opacity",1)}var getX=_ref.getX,xKey=_ref.xKey,keysOfGroups=_ref.keysOfGroups,width=_ref.width,height=_ref.height,chartTitleText=_ref.chartTitleText,tooltipTitle=_ref.tooltipTitle,xAxisText=_ref.xAxisText,yAxisText=_ref.yAxisText,utcParse=_ref.utcParse,marginTop=_ref.marginTop,marginRight=_ref.marginRight,marginBottom=_ref.marginBottom,marginLeft=_ref.marginLeft,xDomain=_ref.xDomain,yDomain=_ref.yDomain,xRange=_ref.xRange,yRange=_ref.yRange,lineNodeRadius=_ref.lineNodeRadius,strokeColor=_ref.strokeColor,areaColor=_ref.areaColor,xType=_ref.xType,yType=_ref.yType,formatTimeType=_ref.formatTimeType,curveType=_ref.curveType,enableLinePath=_ref.enableLinePath,areaOpacity=_ref.areaOpacity,strokeLinecap=_ref.strokeLinecap,strokeLinejoin=_ref.strokeLinejoin,strokeWidth=_ref.strokeWidth,strokeOpacity=_ref.strokeOpacity,animationTime=_ref.animationTime,enableAnimation=_ref.enableAnimation,enableLineNode=_ref.enableLineNode,enableTooltip=_ref.enableTooltip,enableXAxis=_ref.enableXAxis,enableYAxis=_ref.enableYAxis,enableLegend=_ref.enableLegend;void 0===xRange&&(xRange=[marginLeft,width-marginRight]),void 0===yRange&&(yRange=[height-marginBottom,marginTop]),void 0===getX&&(getX=function getX(d){return d[xKey]});var x=[];xType===d3.scaleTime?x=d3.map(d3.map(data,getX),function(d){return formatTimeType(utcParse)(d)}):xType===d3.scaleLinear&&(x=d3.map(d3.map(data,getX)));var y=d3.stack().keys(keysOfGroups).value(function(obj,key){return+obj[key]})(data);keysOfGroups.push("all"),void 0===xDomain&&(xDomain=d3.extent(x)),void 0===yDomain&&(yDomain=[0,1.2*d3.max(y,function(d){return d3.max(d,function(d){return d[1]})})]);var xScale=xType(xDomain,xRange),yScale=yType(yDomain,yRange),xAxisType=d3.axisBottom(xScale).ticks(width/80).tickSizeOuter(0),yAxisType=d3.axisLeft(yScale).ticks(height/40),line0=d3.line().x(function(_,i){return xScale(x[i])}).y(height-marginBottom),line=d3.line().defined(function(d,i){return!isNaN(x[i])&&!isNaN(d[1])}).curve(curveType).x(function(_,i){return xScale(x[i])}).y(function(d){return yScale(d[1])}),area0=d3.area().x(function(_,i){return xScale(x[i])}).y0(height-marginBottom).y(height-marginBottom),area=d3.area().defined(function(d,i){return!isNaN(x[i])&&!isNaN(d[1])}).curve(curveType).x(function(d,i){return xScale(x[i])}).y1(function(d){return yScale(d[1])}).y0(function(d){return yScale(d[0])});void 0===tooltipTitle&&(tooltipTitle=function tooltipTitle(x,d){var xValue=0;return xType===d3.scaleTime?xValue=d3.utcFormat("%Y-%m-%d")(x):xType===d3.scaleLinear&&(xValue=x),"x: ".concat(xValue,"\ny: ").concat(d[1]-d[0],"\naccumulation: ").concat(d[1])});var svg=d3.select(element).attr("width",width).attr("height",height).attr("viewbox",[0,0,width,height]).attr("overflow","visible");if(enableXAxis){var xAxis=svg.append("g").attr("transform","translate(0, ".concat(height-marginBottom,")"));xAxis.call(xAxisType).call(function(g){return g.append("text").attr("x",width-marginRight+25).attr("y",15).attr("fill","black").attr("style","12px").text(xAxisText)})}if(enableYAxis){var yAxis=svg.append("g").attr("transform","translate(".concat(marginLeft,", 0)"));yAxis.call(yAxisType).call(function(g){return g.select(".domain").remove()}).call(function(g){return g.selectAll(".tick line").clone().attr("x2",width-marginLeft-marginRight).attr("stroke-opacity",.1)}).call(function(g){return g.append("text").attr("x",-20).attr("y",marginTop-25).attr("fill","black").attr("style","12px").attr("text-anchor","start").text(yAxisText)})}var chartTitle=svg.append("g");chartTitle.call(function(g){return g.append("text").attr("x",marginLeft+(width-marginRight-marginLeft)/2).attr("y",marginTop/2).attr("fill","black").style("font-size","20px").style("font-weight",550).attr("text-anchor","middle").text(chartTitleText)}),void 0===areaColor&&(areaColor=d3.schemeSet2),void 0===strokeColor&&(strokeColor=areaColor);var areaColorScale=d3.scaleOrdinal(keysOfGroups,areaColor),strokeColorScale=d3.scaleOrdinal(keysOfGroups,strokeColor),areaPath=svg.append("g"),linePath=svg.append("g"),lineNode=svg.append("g");if(enableLinePath&&linePath.selectAll("path").data(y).join("path").attr("class",function(d){return"all _"+d.key}).attr("fill","none").attr("stroke",function(d){return strokeColorScale(d.key)}).attr("stroke-width",strokeWidth).attr("stroke-linecap",strokeLinecap).attr("stroke-linejoin",strokeLinejoin).attr("stroke-opacity",strokeOpacity).attr("d",function(d){return line(d)}),areaPath.selectAll("path").data(y).join("path").attr("class",function(d){return"all _"+d.key}).attr("fill",function(d){return areaColorScale(d.key)}).style("opacity",areaOpacity).attr("d",function(d){return area(d)}),enableLineNode){var createNode=lineNode.selectAll("circle");y.map(function(d,i){createNode.data(d).join("circle").attr("class","all _"+d.key).attr("cx",function(_,i){return xScale(x[i])}).attr("cy",function(d){return yScale(d[1])}).attr("r",lineNodeRadius).attr("fill","white").attr("stroke",strokeColorScale(d.key)).attr("stroke-width",strokeWidth)})}if(enableAnimation){if(areaPath.selectAll("path").attr("fill","rgba(0, 0, 0, 0)").attr("d",function(d){return area0(d)}).transition().attr("fill",function(d){return areaColorScale(d.key)}).attr("d",function(d){return area(d)}).duration(animationTime),enableLinePath){var pathLenth=linePath.selectAll("path").nodes().map(function(node){return node.getTotalLength()});linePath.selectAll("path").data(pathLenth).attr("stroke-dasharray",function(d){return d+" "+d}).attr("stroke-dashoffset",function(d){return d}).transition().ease(d3.easeLinear).attr("stroke-dashoffset",0).duration(animationTime).delay(animationTime)}enableLineNode&&lineNode.selectAll("circle").style("opacity",0).transition().ease(d3.easeLinear).style("opacity",1).duration(animationTime).delay(animationTime)}var tooltip=svg.append("g").style("pointer-events","none");enableTooltip&&lineNode.selectAll("circle").on("mouseover",function showTooltip(_,d){var scaleValue=0;xType===d3.scaleTime?scaleValue=formatTimeType(utcParse)(d.data[xKey]):xType===d3.scaleLinear&&(scaleValue=d.data[xKey]),tooltip.style("display",null),tooltip.attr("transform","translate(\n        ".concat(xScale(scaleValue),",\n        ").concat(yScale(d[1])-lineNodeRadius-10,")"));var path=tooltip.selectAll("path").data([,]).join("path").attr("fill","rgba(250, 250, 250, 0.8)").attr("stroke","black").attr("color","black"),text=tooltip.selectAll("text").data([,]).join("text").style("font-size",(width+height)/80).call(function(text){return text.selectAll("tspan").data("".concat(tooltipTitle(scaleValue,d)).split(/\n/)).join("tspan").attr("x",0).attr("y",function(_,i){return"".concat(1.1*i,"em")}).attr("font-weight",function(_,i){return i?null:"bold"}).text(function(d){return d})}),textBox=text.node().getBBox();tooltip.selectAll("path").attr("d",null),text.attr("transform","translate(".concat(-textBox.width/2,", ").concat(-textBox.height+5,")")),path.attr("d","M".concat(-textBox.width/2-10,",5H-5l5,5l5,-5H").concat(textBox.width/2+10,"v").concat(-textBox.height-20,"h-").concat(textBox.width+20,"z"))}).on("mouseleave",function hideTooltip(){tooltip.style("display","none")});var selectedOne=!1,legend=svg.append("g").attr("transform","translate(".concat(width-marginRight+25+20,", ").concat(marginTop,")")).style("cursor","pointer");enableLegend&&(legend.selectAll("circle").data(keysOfGroups).join("circle").attr("class",function(d){return"all legend_"+d}).attr("cx",0).attr("cy",function(_,i){return 1.1*(20*i)}).attr("r",10).attr("fill",function(d){return areaColorScale(d)}),legend.selectAll("text").data(keysOfGroups).join("text").attr("class",function(d){return"all legend_"+d}).attr("x",20).attr("y",function(_,i){return 1.1*(20*i)+4}).attr("text-anchor","start").style("font-size","12px").style("font-weight",300).text(function(d){return d}),setTimeout(function(){keysOfGroups.slice(0,-1).map(function(d){legend.select(".legend_"+d).on("mouseover",highlight).on("mouseleave",noHighlight).on("click",selectOne)}),legend.select(".legend_all").on("click",selectAll)},2*animationTime))}