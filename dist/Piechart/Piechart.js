'use strict';var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_react=require('react'),_react2=_interopRequireDefault(_react),_d=require('d3'),d3=_interopRequireWildcard(_d),_propTypes=require('prop-types'),_propTypes2=_interopRequireDefault(_propTypes);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _objectWithoutProperties(a,b){var c={};for(var d in a)0<=b.indexOf(d)||Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);return c}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var Piechart=function(a){function b(a){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return _inherits(b,a),_createClass(b,[{key:'componentDidMount',value:function componentDidMount(){var a=this.props,b=a.data,c=_objectWithoutProperties(a,['data']),d=this.refs.el,e=new d3pie(d);e.render(b,c)}},{key:'render',value:function render(){return _react2.default.createElement('svg',{ref:'el'})}}]),b}(_react.Component);Piechart.propTypes={data:_propTypes2.default.array.isRequired,width:_propTypes2.default.number,height:_propTypes2.default.number,margintop:_propTypes2.default.number,marginbottom:_propTypes2.default.number,marginright:_propTypes2.default.number,marginleft:_propTypes2.default.number,radius:_propTypes2.default.number,outerRadius:_propTypes2.default.number,innerRadius:_propTypes2.default.number,gettext:_propTypes2.default.func,getvalue:_propTypes2.default.func,color:_propTypes2.default.oneOfType([_propTypes2.default.func,_propTypes2.default.arrayOf(_propTypes2.default.string)]),onClick:_propTypes2.default.func},Piechart.defaultProps={width:200,height:200,margintop:50,marginbottom:30,marginright:50,marginleft:40,radius:100,outerRadius:.9,innerRadius:0,gettext:function gettext(a){return a.text},getvalue:function getvalue(a){return a.count},color:d3.scaleOrdinal(d3.schemeCategory20),onClick:function onClick(){}};var d3pie=function(){function a(b){_classCallCheck(this,a),this.svg=d3.select(b)}return _createClass(a,[{key:'render',value:function render(a,b){var c=b.width,d=b.height,e=b.margintop,f=b.marginbottom,h=b.marginright,i=b.marginleft,j=b.color,k=b.radius,l=b.outerRadius,m=b.innerRadius,n=b.gettext,o=b.getvalue,p=b.onClick,q=a.map(function(a){return{text:n(a),value:o(a)}}),r=d3.arc().outerRadius(k*l).innerRadius(k*m),s=d3.pie().sort(null).value(function(a){return a.value}),t=this.svg.attr('width',c+i+h).attr('height',d+e+f).append('g').attr('transform','translate(  '+(c+h+i)/2+' , '+(d+e+f)/2+' )'),g=t.selectAll('.arc').data(s(q)).enter().append('g').on('click',p);g.append('path').attr('class','gpath').attr('stroke-width',1).attr('stroke','#fff').transition().duration(1500).attrTween('d',function(a){var b={endAngle:a.startAngle},c=d3.interpolate(b,a);return function(a){return r(c(a))}}).style('fill',function(a){return j(a.data.text)});var u=g.append('text').attr('class','textval').attr('transform',function(a){return'translate( '+r.centroid(a)+' )'}).attr('dy','.35em').attr('text-anchor','middle').text(function(a){return a.data.value}).style('font-size',0).transition().duration(1500).style('font-size','14px'),v=g.append('g').attr('cursor','pointer'),w=v.append('rect').attr('width',15).attr('height',15).attr('transform',function(a,b){return'translate( '+k+' , '+(30*b-k)+')'}).style('fill',function(a){return j(a.data.text)}),x=v.append('text').attr('fill','#000').text(function(a){return a.data.text}).attr('transform',function(a,b){return'translate( '+(k+20)+' , '+(30*b-k+15)+')'});v.on('mouseover',function(a){var b=d3.select(this.parentNode);b.select('rect').attr('stroke','#000'),b.select('path').attr('transform','translate( '+.2*r.centroid(a)[0]+','+.2*r.centroid(a)[1]+' )'),b.select('.textval').attr('transform','translate( '+1.2*r.centroid(a)[0]+','+1.2*r.centroid(a)[1]+' )')}),v.on('mouseout',function(){g.selectAll('rect').attr('stroke','#fff'),g.selectAll('.gpath').attr('transform',function(){return'translate( 0,0 )'}),g.selectAll('.textval').attr('transform',function(a){return'translate( '+r.centroid(a)+' )'})})}}]),a}();exports.default=Piechart;