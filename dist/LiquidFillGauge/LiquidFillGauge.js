"use strict";function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.LiquidFillGauge=LiquidFillGauge;var _react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),d3=_interopRequireWildcard(require("d3"));function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!=key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj["default"]=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _extends(){return _extends=Object.assign?Object.assign.bind():function(target){for(var source,i=1;i<arguments.length;i++)for(var key in source=arguments[i],source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key]);return target},_extends.apply(this,arguments)}function LiquidFillGauge(props){var svgRef=_react["default"].useRef(null),handleLoad=function handleLoad(){var attr=_extends({},props);D3LiquidFillGauge(svgRef.current,attr)};return _react["default"].useEffect(function(){handleLoad()},[props]),_react["default"].createElement("svg",{ref:svgRef})}LiquidFillGauge.propTypes={value:_propTypes["default"].number.isRequired,width:_propTypes["default"].number,height:_propTypes["default"].number,minValue:_propTypes["default"].number,maxValue:_propTypes["default"].number,circleThickness:_propTypes["default"].number,circleFillGap:_propTypes["default"].number,circleColor:_propTypes["default"].string,waveHeight:_propTypes["default"].number,waveCount:_propTypes["default"].number,waveRiseTime:_propTypes["default"].number,waveAnimateTime:_propTypes["default"].number,waveRise:_propTypes["default"].bool,waveHeightScaling:_propTypes["default"].bool,waveAnimate:_propTypes["default"].bool,waveColor:_propTypes["default"].string,waveOffset:_propTypes["default"].number,textVertPosition:_propTypes["default"].number,textSize:_propTypes["default"].number,valueCountUp:_propTypes["default"].bool,displayPercent:_propTypes["default"].bool,textColor:_propTypes["default"].string,waveTextColor:_propTypes["default"].string},LiquidFillGauge.defaultProps={value:50,width:150,height:200,minValue:0,maxValue:100,circleThickness:.05,circleFillGap:.05,circleColor:"#178BCA",waveHeight:.1,waveCount:1,waveRiseTime:2e3,waveAnimateTime:2e3,waveRise:!0,waveHeightScaling:!0,waveAnimate:!0,waveColor:"#178BCA",waveOffset:0,textVertPosition:.9,textSize:.5,valueCountUp:!0,displayPercent:!0,textColor:"#045681",waveTextColor:"#A4DBf8"};function D3LiquidFillGauge(element,_ref){function animateWave(){wave.attr("transform","translate("+waveAnimateScale(wave.attr("T"))+",0)"),wave.transition().duration(waveAnimateTime*(1-wave.attr("T"))).ease(d3.easeLinear).attr("transform","translate("+waveAnimateScale(1)+",0)").attr("T",1).on("end",function(){wave.attr("T",0),animateWave(waveAnimateTime)})}var value=_ref.value,width=_ref.width,height=_ref.height,minValue=_ref.minValue,maxValue=_ref.maxValue,circleThickness=_ref.circleThickness,circleFillGap=_ref.circleFillGap,circleColor=_ref.circleColor,waveHeight=_ref.waveHeight,waveCount=_ref.waveCount,waveRiseTime=_ref.waveRiseTime,waveAnimateTime=_ref.waveAnimateTime,waveRise=_ref.waveRise,waveHeightScaling=_ref.waveHeightScaling,waveAnimate=_ref.waveAnimate,waveColor=_ref.waveColor,waveOffset=_ref.waveOffset,textVertPosition=_ref.textVertPosition,textSize=_ref.textSize,valueCountUp=_ref.valueCountUp,displayPercent=_ref.displayPercent,textColor=_ref.textColor,waveTextColor=_ref.waveTextColor,gauge=d3.select(element);gauge.selectAll("g").remove();var radius=Math.min(width,height)/2-10,locationX=width/2-radius,locationY=height/2-radius,fillPercent=Math.max(minValue,Math.min(maxValue,value))/maxValue,waveHeightScale=waveHeightScaling?d3.scaleLinear().range([0,waveHeight],0).domain([0,50,100]):d3.scaleLinear().range([waveHeight,waveHeight]).domain([0,100]),textPixels=textSize*radius/2,textFinalValue=parseFloat(value).toFixed(2),textStartValue=valueCountUp?minValue:textFinalValue,percentText=displayPercent?"%":"";circleThickness*=radius,circleFillGap*=radius;var fillCircleMargin=circleThickness+circleFillGap,fillCircleRadius=radius-fillCircleMargin;waveHeight=fillCircleRadius*waveHeightScale(100*fillPercent);var waveLength=2*fillCircleRadius/waveCount,waveClipCount=1+waveCount,waveClipWidth=waveLength*waveClipCount,textRounder=function textRounder(v){return Math.round(v)},rand=Math.random();parseFloat(textFinalValue)!=parseFloat(textRounder(textFinalValue))&&(textRounder=function textRounder(v){return parseFloat(v).toFixed(1)}),parseFloat(textFinalValue)!=parseFloat(textRounder(textFinalValue))&&(textRounder=function textRounder(v){return parseFloat(v).toFixed(2)});for(var data=[],i=0;i<=40*waveClipCount;i++)data.push({x:i/(40*waveClipCount),y:i/40});var gaugeCircleX=d3.scaleLinear().range([0,2*Math.PI]).domain([0,1]),gaugeCircleY=d3.scaleLinear().range([0,radius]).domain([0,radius]),waveScaleX=d3.scaleLinear().range([0,waveClipWidth]).domain([0,1]),waveScaleY=d3.scaleLinear().range([0,waveHeight]).domain([0,1]),waveRiseScale=d3.scaleLinear().range([fillCircleMargin+2*fillCircleRadius+waveHeight,fillCircleMargin-waveHeight]).domain([0,1]),waveAnimateScale=d3.scaleLinear().range([0,waveClipWidth-2*fillCircleRadius]),textRiseScaleY=d3.scaleLinear().range([fillCircleMargin+2*fillCircleRadius,fillCircleMargin+.7*textPixels]).domain([0,1]),gaugeGroup=gauge.attr("width",width).attr("height",height).append("g").attr("transform","translate(".concat(locationX,",").concat(locationY,")")),gaugeCircleArc=d3.arc().startAngle(gaugeCircleX(0)).endAngle(gaugeCircleX(1)).outerRadius(gaugeCircleY(radius)).innerRadius(gaugeCircleY(radius-circleThickness));gaugeGroup.append("path").attr("d",gaugeCircleArc).style("fill",circleColor).attr("transform","translate(".concat(radius,",").concat(radius,")"));var text=gaugeGroup.append("text").text(textRounder(textStartValue)+percentText).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size","".concat(textPixels,"px")).style("fill",textColor).attr("transform","translate(".concat(radius,",").concat(textRiseScaleY(textVertPosition),")")),clipArea=d3.area().x(function(d){return waveScaleX(d.x)}).y0(function(d){return waveScaleY(Math.sin(-1*(2*Math.PI*waveOffset)+2*Math.PI*(1-waveCount)+2*d.y*Math.PI))}).y1(function(d){return 2*fillCircleRadius+waveHeight}),waveGroup=gaugeGroup.append("defs").append("clipPath").attr("id","clipWave".concat(rand)),wave=waveGroup.append("path").datum(data).attr("d",clipArea).attr("T",0),fillCircleGroup=gaugeGroup.append("g").attr("clip-path","url(#clipWave".concat(rand,")"));fillCircleGroup.append("circle").attr("cx",radius).attr("cy",radius).attr("r",fillCircleRadius).style("fill",waveColor);var text2=fillCircleGroup.append("text").text(textRounder(textStartValue)+percentText).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size","".concat(textPixels,"px")).style("fill",waveTextColor).attr("transform","translate(".concat(radius,",").concat(textRiseScaleY(textVertPosition),")"));if(valueCountUp){var textTween=function textTween(){var _this=this,i=d3.interpolate(this.textContent,textFinalValue);return function(t){_this.textContent=textRounder(i(t))+percentText}};text.transition().duration(waveRiseTime).tween("text",textTween),text2.transition().duration(waveRiseTime).tween("text",textTween)}var waveGroupXPosition=fillCircleMargin+2*fillCircleRadius-waveClipWidth;waveRise?waveGroup.attr("transform","translate(".concat(waveGroupXPosition,",").concat(waveRiseScale(0),")")).transition().duration(waveRiseTime).attr("transform","translate(".concat(waveGroupXPosition,",").concat(waveRiseScale(fillPercent),")")):waveGroup.attr("transform","translate(".concat(waveGroupXPosition,",").concat(waveRiseScale(fillPercent),")")),waveAnimate&&animateWave()}