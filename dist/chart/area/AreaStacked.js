"use strict";function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=AreaStacked;var _react=_interopRequireDefault(require("react")),d3=_interopRequireWildcard(require("d3")),_propTypes=_interopRequireDefault(require("prop-types")),_tooltip=require("./../../components/tooltip.ts"),_legend=require("./../../components/legend.ts"),_dom=require("./../../utils/dom.ts"),_chart=require("./../../components/chart.ts");function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!=key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj["default"]=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function AreaStacked(props){var svgRef=_react["default"].useRef(null),handleLoad=function(){(0,_chart.RemoveChart)(svgRef),CreateAreaStacked(svgRef,props)};return _react["default"].useEffect(function(){handleLoad()},[props]),_react["default"].createElement("svg",{width:"100%",ref:svgRef})}function CreateAreaStacked(element,props){var data=props.data,mapper=props.mapper,base=props.base,margin=props.margin,xAxis=props.xAxis,yAxis=props.yAxis,stroke=props.stroke,node=props.node,parser=props.parser,fill=props.fill,time=props.time,tooltip=props.tooltip,animation=props.animation,legend=props.legend,font=props.font;if(0!=data.length){void 0===base.width&&(base.width=(0,_dom.getElementWidth)(element)),void 0===base.height&&(base.height=(0,_dom.getElementHeight)(element)),void 0===xAxis.range&&(xAxis.range=[margin.left,base.width-margin.right]),void 0===yAxis.range&&(yAxis.range=[base.height-margin.bottom,margin.top]);var x=[];xAxis.type===d3.scaleTime&&(x=d3.map(d3.map(data,mapper.getX),function(d){return time.type(parser.time)(d)}));var rowKeys=[];mapper.keys.forEach(function(key){return rowKeys.push(key)});var y=d3.stack().keys(rowKeys).value(function(obj,key){return+obj[key]})(data);if(void 0===xAxis.domain&&(xAxis.domain=d3.extent(x)),void 0===yAxis.domain){var domain2=d3.max(y,function(d){return d3.max(d,function(d){return 1.1*d[1]})});yAxis.domain=["0",void 0===domain2?"0":domain2.toString()]}var xScale=xAxis.type(xAxis.domain,xAxis.range),yScale=yAxis.type(yAxis.domain,yAxis.range);void 0===font.size&&(font.size=Math.min(base.width,base.height)/25+"px");var xAxisType=d3.axisBottom(xScale).ticks(base.width/80).tickSizeOuter(0),yAxisType=d3.axisLeft(yScale).ticks(base.height/40),line=d3.line().defined(function(d,i){return!isNaN(x[i])&&!isNaN(d[1])}).curve(stroke.type).x(function(_,i){return xScale(x[i])}).y(function(d){return yScale(d[1])}),area0=d3.area().x(function(_,i){return xScale(x[i])}).y0(base.height-margin.bottom).y(base.height-margin.bottom),area=d3.area().defined(function(d,i){return!isNaN(x[i])&&!isNaN(d[1])}).curve(fill.type).x(function(d,i){return xScale(x[i])}).y1(function(d){return yScale(d[1])}).y0(function(d){return yScale(d[0])});void 0===tooltip.mapper&&(tooltip.mapper=function(d){return"x : ".concat(d.data.date,"\ny : ").concat(d[1]-d[0],"\nstacked : ").concat(d[1])});var svg=d3.select(element.current).attr("width",base.width).attr("height",base.height).attr("viewBox",[0,0,base.width,base.height]).attr("font-family","Source Sans Pro, sans-serif").attr("overflow","visible");if(yAxis.enabled){var YAxis=svg.append("g").attr("transform","translate(".concat(margin.left,", 0)"));YAxis.call(yAxisType).call(function(g){return g.select(".domain").remove()}).call(function(g){return g.selectAll(".tick line").clone().attr("x2",base.width-margin.left-margin.right).attr("stroke-opacity",.1)}).call(function(g){return g.append("text").attr("x",0).attr("y",margin.top-12).attr("font-size","12px").attr("text-anchor","end").attr("fill","currentColor").text(yAxis.title)})}if(xAxis.enabled){var XAxis=svg.append("g").attr("transform","translate(0, ".concat(base.height-margin.bottom,")"));XAxis.call(xAxisType).call(function(g){return g.append("text").attr("x",base.width-margin.right+12).attr("y",0).attr("font-size","12px").attr("text-anchor","start").attr("fill","currentColor").text(xAxis.title)})}var chartTitle=svg.append("g");chartTitle.call(function(g){return g.append("text").attr("x",margin.left+(base.width-margin.right-margin.left)/2).attr("y",margin.top/2).attr("text-anchor","middle").attr("font-size","20px").attr("fill","currentColor").attr("font-weight",550).text(base.title)}),void 0===fill.color&&(fill.color=d3.schemeAccent),void 0===stroke.color&&(stroke.color=fill.color);var areaColorScale=d3.scaleOrdinal(rowKeys,fill.color),strokeColorScale=d3.scaleOrdinal(rowKeys,stroke.color),areaPath=svg.append("g"),linePath=svg.append("g"),lineNode=svg.append("g");if(stroke.enabled&&linePath.selectAll("path").data(y).join("path").attr("class",function(_,i){return"svg-line line_"+i}).attr("fill","none").attr("stroke",function(d){return strokeColorScale(d.key)}).attr("stroke-base.width",stroke.width).attr("stroke-linecap",stroke.linecap).attr("stroke-linejoin",stroke.linejoin).attr("stroke-opacity",stroke.opacity).attr("d",function(d){return line(d)}),areaPath.selectAll("path").data(y).join("path").attr("class",function(_,i){return"svg-area area_"+i}).attr("fill",function(d){return areaColorScale(d.key)}).attr("opacity",fill.opacity).attr("d",function(d){return area(d)}),node.enabled){var createNode=lineNode.selectAll("circle");y.map(function(d,i){createNode.data(d).join("circle").attr("class","svg-node node_"+i).attr("cx",function(_,i){return xScale(x[i])}).attr("cy",function(d){return yScale(d[1])}).attr("r",node.radius).attr("fill",strokeColorScale(d.key)).attr("stroke",strokeColorScale(d.key)).attr("stroke-base.width",stroke.width)})}if(animation.enabled){if(areaPath.selectAll("path").data(y).attr("fill","rgba(0, 0, 0, 0)").attr("d",function(d){return area0(d)}).transition().attr("fill",function(d){return areaColorScale(d.key)}).attr("opacity",fill.opacity).attr("d",function(d){return area(d)}).duration(animation.duration).ease(d3.easeExpInOut),stroke.enabled){var pathLength=linePath.selectAll("path").nodes().map(function(node){return null===node?0:node.getTotalLength()});linePath.selectAll("path").data(pathLength).attr("stroke-dasharray",function(d){return d+" "+d}).attr("stroke-dashoffset",function(d){return d}).transition().ease(d3.easeLinear).attr("stroke-dashoffset",0).duration(animation.duration).ease(d3.easeExpInOut).delay(animation.duration)}node.enabled&&lineNode.selectAll("circle").style("opacity",0).transition().ease(d3.easeLinear).style("opacity",1).duration(animation.duration).ease(d3.easeExpInOut).delay(animation.duration)}var onHover=function(_,i){linePath.selectAll(".svg-line").style("opacity",.1),lineNode.selectAll(".svg-node").style("opacity",.1),areaPath.selectAll(".svg-area").style("opacity",.1),linePath.selectAll(".line_"+i).style("opacity",stroke.opacity),lineNode.selectAll(".node_"+i).style("opacity",stroke.opacity),areaPath.selectAll(".area_"+i).style("opacity",fill.opacity)},noHover=function(){linePath.selectAll(".svg-line").style("opacity",stroke.opacity),lineNode.selectAll(".svg-node").style("opacity",stroke.opacity),areaPath.selectAll(".svg-area").style("opacity",fill.opacity)};if(legend.enabled&&(0,_legend.createLegend)(svg,rowKeys,areaColorScale,props,onHover,noHover),tooltip.enabled){var _createTooltip=(0,_tooltip.createTooltip)(svg,props),showTooltip=_createTooltip.showTooltip,moveTooltip=_createTooltip.moveTooltip,hideTooltip=_createTooltip.hideTooltip;lineNode.selectAll("circle").on("mouseover",showTooltip).on("mousemove",moveTooltip).on("mouseleave",hideTooltip)}}}AreaStacked.propTypes={data:_propTypes["default"].arrayOf(_propTypes["default"].object).isRequired,mapper:_propTypes["default"].objectOf(_propTypes["default"].any),base:_propTypes["default"].objectOf(_propTypes["default"].any),margin:_propTypes["default"].objectOf(_propTypes["default"].number),xAxis:_propTypes["default"].objectOf(_propTypes["default"].any),yAxis:_propTypes["default"].objectOf(_propTypes["default"].any),stroke:_propTypes["default"].objectOf(_propTypes["default"].any),node:_propTypes["default"].objectOf(_propTypes["default"].any),parser:_propTypes["default"].objectOf(_propTypes["default"].any),fill:_propTypes["default"].objectOf(_propTypes["default"].any),time:_propTypes["default"].objectOf(_propTypes["default"].any),tooltip:_propTypes["default"].objectOf(_propTypes["default"].any),animation:_propTypes["default"].objectOf(_propTypes["default"].any),font:_propTypes["default"].objectOf(_propTypes["default"].any),legend:_propTypes["default"].objectOf(_propTypes["default"].any)},AreaStacked.defaultProps={mapper:{getX:function getX(d){return d.x},keys:["y"]},base:{width:void 0,height:300,title:""},tooltip:{mapper:void 0,enabled:!0},xAxis:{title:"x",type:d3.scaleTime,domain:void 0,range:void 0,enabled:!0},yAxis:{title:"y",type:d3.scaleLinear,domain:void 0,range:void 0,enabled:!0},parser:{time:"%Y-%m-%d"},time:{type:d3.timeParse},stroke:{color:void 0,type:d3.curveMonotoneX,linecap:"round",linejoin:"round",width:1.5,opacity:1,enabled:!0},margin:{top:40,right:80,bottom:60,left:60},node:{radius:5,enabled:!0},fill:{color:void 0,opacity:.3,type:d3.curveMonotoneX},animation:{duration:1e3,enabled:!0},legend:{enabled:!0},font:{size:"12px"}};