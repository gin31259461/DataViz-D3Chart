"use strict";function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=BubbleChart;var _react=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),d3=_interopRequireWildcard(require("d3")),_chart=require("./../../components/chart.ts"),_dom=require("./../../utils/dom.ts"),_svg=require("./../../components/svg.ts"),_axis=require("./../../components/axis.ts"),_tooltip=require("./../../components/tooltip.ts"),_text=require("./../../components/text.ts"),_legend=require("./../../components/legend.ts");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!=key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj["default"]=obj,cache&&cache.set(obj,newObj),newObj}function BubbleChart(props){var svgRef=_react["default"].useRef(null),handleLoad=function(){(0,_chart.RemoveChart)(svgRef),CreateBubbleChart(svgRef,props)};return(0,_react.useEffect)(function(){handleLoad()},[props]),_react["default"].createElement("svg",{width:"100%",ref:svgRef})}function CreateBubbleChart(element,props){var data=props.data,mapper=props.mapper,base=props.base,margin=props.margin,xAxis=props.xAxis,yAxis=props.yAxis,zAxis=props.zAxis,tooltip=props.tooltip,animation=props.animation,legend=props.legend,font=props.font;if(0!==data.length){void 0===base.width&&(base.width=(0,_dom.getElementWidth)(element)),void 0===base.height&&(base.height=(0,_dom.getElementHeight)(element)),void 0===xAxis.range&&(xAxis.range=[margin.left,base.width-margin.right]),void 0===yAxis.range&&(yAxis.range=[base.height-margin.bottom,margin.top]),void 0===zAxis.range&&(zAxis.range=[5,zAxis.zMax]),void 0===xAxis.type&&(xAxis.type=d3.scaleLinear),void 0===yAxis.type&&(yAxis.type=d3.scaleLinear);var des,x=d3.map(data,mapper.getX),y=d3.map(data,mapper.getY),r=d3.map(data,mapper.getR),I=d3.range(x.length);void 0!==mapper.getDes&&(des=d3.map(data,mapper.getDes));var group=d3.map(data,mapper.getGroup),distinctGroup=new d3.InternSet(group);void 0===xAxis.domain&&(xAxis.domain=[.9*d3.min(x),1.1*d3.max(x)]),void 0===yAxis.domain&&(yAxis.domain=[.9*d3.min(y),1.1*d3.max(y)]),void 0===zAxis.domain&&(zAxis.domain=[0,d3.max(r)]);var xScale=d3.scaleLinear(xAxis.domain,xAxis.range),yScale=d3.scaleLinear(yAxis.domain,yAxis.range),rScale=d3.scaleLinear(zAxis.domain,zAxis.range);void 0===font.size&&(font.size=Math.min(base.width,base.height)/25+"px"),void 0===base.color&&(base.color=d3.schemeAccent);var colorScale=d3.scaleOrdinal(group,base.color);void 0===tooltip.mapper&&(tooltip.mapper=function(i){return"Title : ".concat(des[i],"\nGroup : ").concat(group[i],"\nx : ").concat(x[i],"\ny : ").concat(y[i],"\nr : ").concat(r[i])});var svg=(0,_svg.createSVG)(element,base.width,base.height);if((0,_text.createTitle)(svg,props),xAxis.enabled&&(0,_axis.createXAxis)(svg,d3.axisBottom(xScale).tickSizeOuter(0),props,!0),yAxis.enabled){var yAxisGenerator=d3.axisLeft(yScale).ticks(base.height/40).tickSizeOuter(0);(0,_axis.createYAxis)(svg,yAxisGenerator,props)}var bubbles=svg.append("g");bubbles.selectAll("circle").data(I).join("circle").attr("class",function(i){return"bubbles bubble_"+Array.from(distinctGroup).indexOf(group[i])}).attr("fill",function(i){return colorScale(group[i])+"B3"}).attr("stroke","black").attr("stroke-width","0.5px").attr("cx",function(i){return xScale(x[i])}).attr("cy",function(i){return yScale(y[i])}).attr("r",function(i){return rScale(r[i])}),animation.enabled&&bubbles.selectAll("circle").data(I).attr("r",0).transition().attr("r",function(i){return rScale(r[i])}).duration(animation.duration).ease(d3.easeExpInOut);var onHover=function(_,i){bubbles.selectAll(".bubbles").style("opacity",.1),bubbles.selectAll(".bubble_"+i).style("opacity",1)},noHover=function(){bubbles.selectAll(".bubbles").style("opacity",1)};if(legend.enabled&&(0,_legend.createLegend)(svg,Array.from(distinctGroup),colorScale,props,onHover,noHover),tooltip.enabled){var _createTooltip=(0,_tooltip.createTooltip)(svg,props),showTooltip=_createTooltip.showTooltip,moveTooltip=_createTooltip.moveTooltip,hideTooltip=_createTooltip.hideTooltip;bubbles.selectAll(".bubbles").on("mouseover",showTooltip).on("mousemove",moveTooltip).on("mouseleave",hideTooltip)}}}BubbleChart.propTypes={data:_propTypes["default"].arrayOf(_propTypes["default"].object).isRequired,map:_propTypes["default"].objectOf(_propTypes["default"].any),base:_propTypes["default"].objectOf(_propTypes["default"].any),margin:_propTypes["default"].objectOf(_propTypes["default"].number),xAxis:_propTypes["default"].objectOf(_propTypes["default"].any),yAxis:_propTypes["default"].objectOf(_propTypes["default"].any),tooltip:_propTypes["default"].objectOf(_propTypes["default"].any),animation:_propTypes["default"].objectOf(_propTypes["default"].any),legend:_propTypes["default"].objectOf(_propTypes["default"].any),font:_propTypes["default"].objectOf(_propTypes["default"].any)},BubbleChart.defaultProps={mapper:{getX:function getX(d){return d.x},getY:function getY(d){return d.y},getR:function getR(d){return d.z},getGroup:function getGroup(d){return d.group}},base:{width:void 0,height:300,title:"",color:void 0},tooltip:{mapper:void 0,enabled:!0},xAxis:{title:"x",type:d3.scaleTime,domain:void 0,range:void 0,padding:0,tickRotation:void 0,tickOffset:void 0,enabled:!0},yAxis:{title:"y",type:d3.scaleLinear,domain:void 0,range:void 0,enabled:!0},zAxis:{domain:void 0,range:void 0,zMax:30},margin:{top:40,right:100,bottom:60,left:60},animation:{duration:1e3,enabled:!0},legend:{enabled:!0},font:{size:"12px"}};