"use strict";function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=WordCloud;var _react=_interopRequireDefault(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),d3=_interopRequireWildcard(require("d3")),_d3Cloud=_interopRequireDefault(require("d3-cloud")),_chart=require("./../../components/chart.ts"),_svg=require("./../../components/svg.ts"),_dom=require("./../../utils/dom.ts");function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!=key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj["default"]=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function WordCloud(props){var svgRef=_react["default"].useRef(null),handleLoad=function(){(0,_chart.RemoveChart)(svgRef),createWordCloud(svgRef,props)};return _react["default"].useEffect(function(){handleLoad()},[props]),_react["default"].createElement("svg",{ref:svgRef})}function createWordCloud(element,props){var wordData=props.wordData,margin=props.margin,base=props.base,animation=props.animation,word=props.word;if(0!==wordData.length){void 0===base.width&&(base.width=(0,_dom.getElementWidth)(element)),void 0===base.height&&(base.height=(0,_dom.getElementHeight)(element));var wordList=wordData.split(/[\s.]+/g).map(function(w){return w.replace(/^[“‘"\-—()\[\]{}]+/g,"")}).map(function(w){return w.replace(/[;:.!?()\[\]{},"'’”\-—]+$/g,"")}).map(function(w){return w.replace(/['’]s$/g,"")}).map(function(w){return w.substring(0,30)}).map(function(w){return w.toLowerCase()}),contentWidth=base.width-margin.left-margin.right,contentHeight=base.height-margin.top-margin.bottom,svg=(0,_svg.createSVG)(element,base.width,base.height),wordMap=new Map;wordList.forEach(function(d){void 0===wordMap.get(d)?wordMap.set(d,1):wordMap.set(d,wordMap.get(d)+1)});var data=[];wordMap.forEach(function(v,k){data.push({text:k,size:v})}),void 0===word.size.range&&(word.size.range=[15,75]),void 0===word.size.domain&&(word.size.domain=[0,d3.max(data,function(d){return d.size})]),void 0===word.color.range&&(word.color.range=["#ace","#0f0"]),void 0===word.color.domain&&(word.color.domain=[0,100]);var interpolator=d3.interpolate(word.color.range[0],word.color.range[1]),wordScale=d3.scaleLinear().range(word.size.range).domain(word.size.domain),colorScale=d3.scaleSequential().interpolator(interpolator).domain(word.color.domain);svg.append("g").attr("transform","translate(\n      ".concat(margin.left+contentWidth/2,",\n      ").concat(margin.top+contentHeight/2,")"));var render=function(word){svg.select("g").append("g").selectAll("text").data(word).join("text").attr("font-size",function(d){return d.size}).attr("fill",function(d){return colorScale(d.size)}).attr("text-anchor","middle").attr("transform",function(d){return"translate(".concat(d.x,", ").concat(d.y,") rotate(").concat(d.rotate,")")}).text(function(d){return d.text})},wordLayout=(0,_d3Cloud["default"])().size([base.width,base.height]).words(data).rotate(word.mapper.rotation).padding(word.padding).fontSize(function(d){return wordScale(d.size)}).on("end",render),wordRender=Promise.resolve(wordLayout.start());animation.enabled?wordRender.then(function(){svg.selectAll("text").attr("opacity",0).transition().attr("opacity",1).duration(animation.duration).ease(d3.easeExpInOut)}):wordRender}}WordCloud.propTypes={wordData:_propTypes["default"].string.isRequired,base:_propTypes["default"].objectOf(_propTypes["default"].any),margin:_propTypes["default"].objectOf(_propTypes["default"].any),word:_propTypes["default"].objectOf(_propTypes["default"].any),animation:_propTypes["default"].objectOf(_propTypes["default"].any)},WordCloud.defaultProps={base:{width:void 0,height:void 0},margin:{top:50,bottom:50,right:50,left:50},word:{mapper:{getWord:function getWord(d){return d.text},getSize:function getSize(){return .3+Math.random()},rotation:function rotation(){return 30*(~~(6*Math.random())-3)}},size:{range:void 0,domain:void 0},color:{range:void 0,domain:void 0},padding:3},animation:{duration:3e3,enabled:!0}};